import{a as Q,r as i,m as W,j as X,n as Y,b as _,o as S,d as x,f as a,e as t,q as d,s as g,t as b,v as R,x as T,y as M}from"./index-c0f6c6fe.js";import{P as Z,_ as ee,a as U,h as $}from"./Helper-31e3c862.js";const le={class:"grid"},oe={class:"col-12"},te={class:"card"},ae={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},se=a("h5",{class:"m-0"},"Инициаторы звонков",-1),ie={class:"block mt-2 md:mt-0 p-input-icon-left"},ue=a("i",{class:"pi pi-search"},null,-1),de=a("span",{class:"p-column-title"},"IP",-1),re=a("span",{class:"p-column-title"},"Группа",-1),ne=a("span",{class:"p-column-title"},"Создан",-1),ce=a("span",{class:"p-column-title"},"Изменён",-1),me=a("span",{class:"p-column-title"},"Автор",-1),ve={class:"align-items-center"},pe={class:"formgrid grid"},_e={class:"field col"},fe=a("label",{for:"source_ip"},"IP адрес",-1),he={key:0,class:"p-invalid"},ge={class:"field col"},be=a("label",{for:"source_group"},"Имя группы",-1),we={key:0,class:"p-invalid"},ye={class:"field"},Ve=a("label",{for:"created"},"Создан",-1),De={class:"field"},ke=a("label",{for:"modified"},"Изменён",-1),Se={class:"field"},xe=a("label",{for:"author"},"Автор",-1),Te={__name:"SourceGroup",setup(Ce){const f=Q(),C=i(null),v=i(!1);i(!1);const w=i(!1),y=i(!1),e=i({}),c=i(null),P=i(null),V=i({}),m=i(!1),k=i(!1),h=new Z("/api/kamailio/sourcegroup",f);W(()=>{E()}),X(()=>{p()});const p=()=>{k.value=!0,h.getData(null,(s,l)=>{console.log(s,l),C.value=l,k.value=!1})},N=()=>{e.value={},m.value=!1,v.value=!0},L=()=>{v.value=!1,m.value=!1},B=s=>{let l=s.source_group;h.setData(s,r=>{console.log(r),f.add({severity:"success",summary:"Создание",detail:`Запись создана - ${l}`,life:3e3}),p()})},I=(s,l)=>{let r=l.source_group;h.editData(s,l,u=>{console.log(u),f.add({severity:"success",summary:"Редактирование",detail:`Запись изменена - ${r}`,life:3e3}),p()})},q=()=>{m.value=!0,e.value.source_ip&&e.value.source_ip.trim()&&e.value.source_group&&e.value.source_group.trim()&&(e.value.id?I(e.value.id,e.value):B(e.value),v.value=!1,e.value={})},F=s=>{e.value={...s},console.log(e),v.value=!0},j=s=>{e.value=s,w.value=!0},G=()=>{w.value=!1;let s=e.value.source_group;h.removeData(e.value.id,l=>{console.log("Удаление: ",e.value.id,l),f.add({severity:"success",summary:"Удаление",detail:`Запись удалена - ${s}`,life:3e3}),p()}),e.value={}},O=()=>{P.value.exportCSV()},z=()=>{y.value=!0},A=()=>{let s=0,l=c.value.length;y.value=!1;for(let r of c.value){let u=r.source_group;h.removeData(r.id,n=>{console.log("Удаление: ",r.id,n),f.add({severity:"success",summary:"Удаление",detail:`Запись удалена - ${u}`,life:3e3}),s++,l===s&&p()})}c.value=null},E=()=>{V.value={global:{value:null,matchMode:Y.CONTAINS}}};return(s,l)=>{const r=_("Toast"),u=_("InputText"),n=_("Column"),D=_("Button"),K=_("DataTable"),H=_("Dialog");return S(),x("div",le,[a("div",oe,[a("div",te,[t(r),t(ee,{"btn-delete-disabled":!c.value||!c.value.length,"open-new-handler":N,"confirm-delete-selected-handler":z,"refresh-handler":p,"export-handler":O},null,8,["btn-delete-disabled"]),t(K,{ref_key:"dt",ref:P,value:C.value,selection:c.value,"onUpdate:selection":l[1]||(l[1]=o=>c.value=o),dataKey:"id",paginator:!0,rows:10,filters:V.value,removableSort:"",loading:k.value,"row-hover":"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} rows",responsiveLayout:"scroll"},{header:d(()=>[a("div",ae,[se,a("span",ie,[ue,t(u,{modelValue:V.value.global.value,"onUpdate:modelValue":l[0]||(l[0]=o=>V.value.global.value=o),placeholder:"Search..."},null,8,["modelValue"])])])]),default:d(()=>[t(n,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(n,{field:"source_ip",header:"IP",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(o=>[de,g(" "+b(o.data.source_ip),1)]),_:1}),t(n,{field:"source_group",header:"Группа",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(o=>[re,g(" "+b(o.data.source_group),1)]),_:1}),t(n,{field:"created",header:"Создан",sortable:!0,headerStyle:"width:18%; min-width:8rem;"},{body:d(o=>[ne,g(" "+b(R($).formatDateTime(o.data.created)),1)]),_:1}),t(n,{field:"modified",header:"Изменён",sortable:!0,headerStyle:"width:18%; min-width:8rem;"},{body:d(o=>[ce,g(" "+b(R($).formatDateTime(o.data.modified)),1)]),_:1}),t(n,{field:"author",header:"Автор",sortable:!0,headerStyle:"width:16%; min-width:10rem;"},{body:d(o=>[me,g(" "+b(o.data.author),1)]),_:1}),t(n,{headerStyle:"min-width:10rem;"},{body:d(o=>[a("div",ve,[t(D,{icon:"pi pi-pencil",class:"p-button-rounded p-button-warning mr-2",onClick:J=>F(o.data),title:"Редактировать"},null,8,["onClick"]),t(D,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger mt-2",onClick:J=>j(o.data),title:"Удалить"},null,8,["onClick"])])]),_:1})]),_:1},8,["value","selection","filters","loading"]),t(H,{visible:v.value,"onUpdate:visible":l[7]||(l[7]=o=>v.value=o),style:{width:"450px"},header:"Детали записи",modal:!0,class:"p-fluid"},{footer:d(()=>[t(D,{label:"Отмена",icon:"pi pi-times",class:"p-button-text",onClick:L}),t(D,{label:"Сохранить",icon:"pi pi-check",class:"p-button-text",onClick:q})]),default:d(()=>[a("div",pe,[a("div",_e,[fe,t(u,{id:"source_ip",modelValue:e.value.source_ip,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.source_ip=o),modelModifiers:{trim:!0},required:"true",autofocus:"",class:T({"p-invalid":m.value&&!e.value.source_ip}),placeholder:"пример: 127.0.0.1"},null,8,["modelValue","class"]),m.value&&!e.value.source_ip?(S(),x("small",he,"Обязательно")):M("",!0)]),a("div",ge,[be,t(u,{id:"source_group",modelValue:e.value.source_group,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.source_group=o),modelModifiers:{trim:!0},required:"true",autofocus:"",class:T({"p-invalid":m.value&&!e.value.source_group}),placeholder:"пример: group_name"},null,8,["modelValue","class"]),m.value&&!e.value.source_group?(S(),x("small",we,"Обязательно")):M("",!0)])]),a("div",ye,[Ve,t(u,{id:"created",modelValue:e.value.created,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.created=o),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),a("div",De,[ke,t(u,{id:"modified",modelValue:e.value.modified,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.modified=o),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),a("div",Se,[xe,t(u,{id:"author",modelValue:e.value.author,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.author=o),modelModifiers:{trim:!0},required:"true",disabled:""},null,8,["modelValue"])])]),_:1},8,["visible"]),t(U,{visible:w.value,"onUpdate:visible":l[8]||(l[8]=o=>w.value=o),title:"Внимание",msg:e.value?`Вы уверены, что хотите удалить ${e.value.source_group}?`:null,handler:G},null,8,["visible","msg"]),t(U,{visible:y.value,"onUpdate:visible":l[9]||(l[9]=o=>y.value=o),title:"Внимание",msg:"Вы уверены, что хотите удалить выделенные записи?",handler:A},null,8,["visible"])])])])}}};export{Te as default};
