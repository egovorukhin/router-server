import{a as W,r as i,m as X,j as Y,n as Z,b as v,o as x,d as S,f as a,e as t,q as u,s as h,t as b,v as T,x as P,y as M}from"./index-c0f6c6fe.js";import{P as ee,_ as le,a as U,h as $}from"./Helper-31e3c862.js";const oe={class:"grid"},te={class:"col-12"},ae={class:"card"},se={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ie=a("h5",{class:"m-0"},"Инициаторы звонков",-1),ue={class:"block mt-2 md:mt-0 p-input-icon-left"},ne=a("i",{class:"pi pi-search"},null,-1),de=a("span",{class:"p-column-title"},"Группа",-1),re=a("span",{class:"p-column-title"},"Правило",-1),ce=a("span",{class:"p-column-title"},"Создан",-1),me=a("span",{class:"p-column-title"},"Изменён",-1),ve=a("span",{class:"p-column-title"},"Автор",-1),pe={class:"align-items-center"},_e={class:"field"},fe=a("label",{for:"source_group"},"Имя группы",-1),ge={key:0,class:"p-invalid"},he={class:"field"},be=a("label",{for:"routing_policy"},"Правило",-1),we={key:0,class:"p-invalid"},ye={class:"field"},Ve=a("label",{for:"created"},"Создан",-1),De={class:"field"},ke=a("label",{for:"modified"},"Изменён",-1),xe={class:"field"},Se=a("label",{for:"author"},"Автор",-1),Pe={__name:"RouteGroup",setup(Ce){const f=W(),C=i(null),p=i(!1);i(!1);const w=i(!1),y=i(!1),e=i({}),c=i(null),R=i(null),V=i({}),m=i(!1),k=i(!1),g=new ee("/api/kamailio/routegroup",f);X(()=>{E()}),Y(()=>{_()});const _=()=>{k.value=!0,g.getData(null,(s,l)=>{console.log(s,l),C.value=l,k.value=!1})},N=()=>{e.value={},m.value=!1,p.value=!0},L=()=>{p.value=!1,m.value=!1},B=s=>{let l=s.source_group;g.setData(s,n=>{console.log(n),f.add({severity:"success",summary:"Создание",detail:`Запись создана - ${l}`,life:3e3}),_()})},q=(s,l)=>{let n=l.source_group;g.editData(s,l,d=>{console.log(d),f.add({severity:"success",summary:"Редактирование",detail:`Запись изменена - ${n}`,life:3e3}),_()})},F=()=>{m.value=!0,e.value.routing_policy&&e.value.routing_policy.trim()&&e.value.source_group&&e.value.source_group.trim()&&(e.value.id?q(e.value.id,e.value):B(e.value),p.value=!1,e.value={})},I=s=>{e.value={...s},console.log(e),p.value=!0},j=s=>{e.value=s,w.value=!0},G=()=>{w.value=!1;let s=e.value.source_group;g.removeData(e.value.id,l=>{console.log("Удаление: ",e.value.id,l),f.add({severity:"success",summary:"Удаление",detail:`Запись удалена - ${s}`,life:3e3}),_()}),e.value={}},O=()=>{R.value.exportCSV()},z=()=>{y.value=!0},A=()=>{let s=0,l=c.value.length;y.value=!1;for(let n of c.value){let d=n.source_group;g.removeData(n.id,r=>{console.log("Удаление: ",n.id,r),f.add({severity:"success",summary:"Удаление",detail:`Запись удалена - ${d}`,life:3e3}),s++,l===s&&_()})}c.value=null},E=()=>{V.value={global:{value:null,matchMode:Z.CONTAINS}}};return(s,l)=>{const n=v("Toast"),d=v("InputText"),r=v("Column"),D=v("Button"),K=v("DataTable"),H=v("Textarea"),J=v("Dialog");return x(),S("div",oe,[a("div",te,[a("div",ae,[t(n),t(le,{"btn-delete-disabled":!c.value||!c.value.length,"open-new-handler":N,"confirm-delete-selected-handler":z,"refresh-handler":_,"export-handler":O},null,8,["btn-delete-disabled"]),t(K,{ref_key:"dt",ref:R,value:C.value,selection:c.value,"onUpdate:selection":l[1]||(l[1]=o=>c.value=o),dataKey:"id",paginator:!0,rows:10,filters:V.value,removableSort:"",loading:k.value,"row-hover":"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} rows",responsiveLayout:"scroll"},{header:u(()=>[a("div",se,[ie,a("span",ue,[ne,t(d,{modelValue:V.value.global.value,"onUpdate:modelValue":l[0]||(l[0]=o=>V.value.global.value=o),placeholder:"Search..."},null,8,["modelValue"])])])]),default:u(()=>[t(r,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(r,{field:"source_group",header:"Группа",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(o=>[de,h(" "+b(o.data.source_group),1)]),_:1}),t(r,{field:"routing_policy",header:"Правило",sortable:!0,headerStyle:"width:20%; min-width:10rem;"},{body:u(o=>[re,h(" "+b(o.data.routing_policy),1)]),_:1}),t(r,{field:"created",header:"Создан",sortable:!0,headerStyle:"width:18%; min-width:8rem;"},{body:u(o=>[ce,h(" "+b(T($).formatDateTime(o.data.created)),1)]),_:1}),t(r,{field:"modified",header:"Изменён",sortable:!0,headerStyle:"width:18%; min-width:8rem;"},{body:u(o=>[me,h(" "+b(T($).formatDateTime(o.data.modified)),1)]),_:1}),t(r,{field:"author",header:"Автор",sortable:!0,headerStyle:"width:16%; min-width:10rem;"},{body:u(o=>[ve,h(" "+b(o.data.author),1)]),_:1}),t(r,{headerStyle:"min-width:10rem;"},{body:u(o=>[a("div",pe,[t(D,{icon:"pi pi-pencil",class:"p-button-rounded p-button-warning mr-2",onClick:Q=>I(o.data),title:"Редактировать"},null,8,["onClick"]),t(D,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger mt-2",onClick:Q=>j(o.data),title:"Удалить"},null,8,["onClick"])])]),_:1})]),_:1},8,["value","selection","filters","loading"]),t(J,{visible:p.value,"onUpdate:visible":l[7]||(l[7]=o=>p.value=o),style:{width:"450px"},header:"Детали записи",modal:!0,class:"p-fluid"},{footer:u(()=>[t(D,{label:"Отмена",icon:"pi pi-times",class:"p-button-text",onClick:L}),t(D,{label:"Сохранить",icon:"pi pi-check",class:"p-button-text",onClick:F})]),default:u(()=>[a("div",_e,[fe,t(d,{id:"source_group",modelValue:e.value.source_group,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.source_group=o),modelModifiers:{trim:!0},required:"true",autofocus:"",class:P({"p-invalid":m.value&&!e.value.source_group}),placeholder:"пример: group_name"},null,8,["modelValue","class"]),m.value&&!e.value.source_group?(x(),S("small",ge,"Обязательно")):M("",!0)]),a("div",he,[be,t(H,{id:"routing_policy",modelValue:e.value.routing_policy,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.routing_policy=o),required:"true",rows:"3",cols:"20",autofocus:"",class:P({"p-invalid":m.value&&!e.value.routing_policy})},null,8,["modelValue","class"]),m.value&&!e.value.routing_policy?(x(),S("small",we,"Обязательно")):M("",!0)]),a("div",ye,[Ve,t(d,{id:"created",modelValue:e.value.created,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.created=o),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),a("div",De,[ke,t(d,{id:"modified",modelValue:e.value.modified,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.modified=o),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),a("div",xe,[Se,t(d,{id:"author",modelValue:e.value.author,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.author=o),modelModifiers:{trim:!0},required:"true",disabled:""},null,8,["modelValue"])])]),_:1},8,["visible"]),t(U,{visible:w.value,"onUpdate:visible":l[8]||(l[8]=o=>w.value=o),title:"Внимание",msg:e.value?`Вы уверены, что хотите удалить ${e.value.source_group}?`:null,handler:G},null,8,["visible","msg"]),t(U,{visible:y.value,"onUpdate:visible":l[9]||(l[9]=o=>y.value=o),title:"Внимание",msg:"Вы уверены, что хотите удалить выделенные записи?",handler:A},null,8,["visible"])])])])}}};export{Pe as default};
