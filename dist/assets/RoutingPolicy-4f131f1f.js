import{a as W,r as i,m as X,j as Y,n as Z,b as v,o as x,d as S,f as a,e as t,q as n,s as h,t as b,v as R,x as T,y as M}from"./index-5e528b76.js";import{P as ee,_ as le,a as U,h as $}from"./Helper-eeaa13b4.js";const oe={class:"grid"},te={class:"col-12"},ae={class:"card"},se={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ie=a("h5",{class:"m-0"},"Инициаторы звонков",-1),ne={class:"block mt-2 md:mt-0 p-input-icon-left"},ue=a("i",{class:"pi pi-search"},null,-1),de=a("span",{class:"p-column-title"},"Группа",-1),re=a("span",{class:"p-column-title"},"Правило",-1),ce=a("span",{class:"p-column-title"},"Создан",-1),me=a("span",{class:"p-column-title"},"Изменён",-1),ve=a("span",{class:"p-column-title"},"Автор",-1),pe={class:"align-items-center"},_e={class:"field"},fe=a("label",{for:"source_group"},"Имя группы",-1),ge={key:0,class:"p-invalid"},he={class:"field"},be=a("label",{for:"routing_policy"},"Правило",-1),ye={key:0,class:"p-invalid"},we={class:"field"},Ve=a("label",{for:"created"},"Создан",-1),De={class:"field"},ke=a("label",{for:"modified"},"Изменён",-1),xe={class:"field"},Se=a("label",{for:"author"},"Автор",-1),Te={__name:"RoutingPolicy",setup(Ce){const f=W(),C=i(null),p=i(!1);i(!1);const y=i(!1),w=i(!1),e=i({}),c=i(null),P=i(null),V=i({}),m=i(!1),k=i(!1),g=new ee("/api/kamailio/routingpolicy",f);X(()=>{K()}),Y(()=>{_()});const _=()=>{k.value=!0,g.getData(null,s=>{console.log(s),C.value=s,k.value=!1})},N=()=>{e.value={},m.value=!1,p.value=!0},L=()=>{p.value=!1,m.value=!1},B=s=>{let o=s.source_group;g.setData(s,u=>{console.log(u),f.add({severity:"success",summary:"Создание",detail:`Запись создана - ${o}`,life:3e3}),_()})},q=(s,o)=>{let u=o.source_group;g.editData(s,o,d=>{console.log(d),f.add({severity:"success",summary:"Редактирование",detail:`Запись изменена - ${u}`,life:3e3}),_()})},F=()=>{m.value=!0,e.value.routing_policy&&e.value.routing_policy.trim()&&e.value.source_group&&e.value.source_group.trim()&&(e.value.id?q(e.value.id,e.value):B(e.value),p.value=!1,e.value={})},I=s=>{e.value={...s},console.log(e),p.value=!0},j=s=>{e.value=s,y.value=!0},O=()=>{y.value=!1;let s=e.value.source_group;g.removeData(e.value.id,o=>{console.log("Удаление: ",e.value.id,o),f.add({severity:"success",summary:"Удаление",detail:`Запись удалена - ${s}`,life:3e3}),_()}),e.value={}},z=()=>{P.value.exportCSV()},A=()=>{w.value=!0},E=()=>{let s=0,o=c.value.length;w.value=!1;for(let u of c.value){let d=u.source_group;g.removeData(u.id,r=>{console.log("Удаление: ",u.id,r),f.add({severity:"success",summary:"Удаление",detail:`Запись удалена - ${d}`,life:3e3}),s++,o===s&&_()})}c.value=null},K=()=>{V.value={global:{value:null,matchMode:Z.CONTAINS}}};return(s,o)=>{const u=v("Toast"),d=v("InputText"),r=v("Column"),D=v("Button"),G=v("DataTable"),H=v("Textarea"),J=v("Dialog");return x(),S("div",oe,[a("div",te,[a("div",ae,[t(u),t(le,{"btn-delete-disabled":!c.value||!c.value.length,"open-new-handler":N,"confirm-delete-selected-handler":A,"refresh-handler":_,"export-handler":z},null,8,["btn-delete-disabled"]),t(G,{ref_key:"dt",ref:P,value:C.value,selection:c.value,"onUpdate:selection":o[1]||(o[1]=l=>c.value=l),dataKey:"id",paginator:!0,rows:10,filters:V.value,removableSort:"",loading:k.value,"row-hover":"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} rows",responsiveLayout:"scroll"},{header:n(()=>[a("div",se,[ie,a("span",ne,[ue,t(d,{modelValue:V.value.global.value,"onUpdate:modelValue":o[0]||(o[0]=l=>V.value.global.value=l),placeholder:"Search..."},null,8,["modelValue"])])])]),default:n(()=>[t(r,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(r,{field:"source_group",header:"Группа",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:n(l=>[de,h(" "+b(l.data.source_group),1)]),_:1}),t(r,{field:"routing_policy",header:"Правило",sortable:!0,headerStyle:"width:20%; min-width:10rem;"},{body:n(l=>[re,h(" "+b(l.data.routing_policy),1)]),_:1}),t(r,{field:"created",header:"Создан",sortable:!0,headerStyle:"width:18%; min-width:8rem;"},{body:n(l=>[ce,h(" "+b(R($).formatDateTime(l.data.created)),1)]),_:1}),t(r,{field:"modified",header:"Изменён",sortable:!0,headerStyle:"width:18%; min-width:8rem;"},{body:n(l=>[me,h(" "+b(R($).formatDateTime(l.data.modified)),1)]),_:1}),t(r,{field:"author",header:"Автор",sortable:!0,headerStyle:"width:16%; min-width:10rem;"},{body:n(l=>[ve,h(" "+b(l.data.author),1)]),_:1}),t(r,{headerStyle:"min-width:10rem;"},{body:n(l=>[a("div",pe,[t(D,{icon:"pi pi-pencil",class:"p-button-rounded p-button-warning mr-2",onClick:Q=>I(l.data),title:"Редактировать"},null,8,["onClick"]),t(D,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger mt-2",onClick:Q=>j(l.data),title:"Удалить"},null,8,["onClick"])])]),_:1})]),_:1},8,["value","selection","filters","loading"]),t(J,{visible:p.value,"onUpdate:visible":o[7]||(o[7]=l=>p.value=l),style:{width:"450px"},header:"Детали записи",modal:!0,class:"p-fluid"},{footer:n(()=>[t(D,{label:"Отмена",icon:"pi pi-times",class:"p-button-text",onClick:L}),t(D,{label:"Сохранить",icon:"pi pi-check",class:"p-button-text",onClick:F})]),default:n(()=>[a("div",_e,[fe,t(d,{id:"source_group",modelValue:e.value.source_group,"onUpdate:modelValue":o[2]||(o[2]=l=>e.value.source_group=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:T({"p-invalid":m.value&&!e.value.source_group}),placeholder:"пример: group_name"},null,8,["modelValue","class"]),m.value&&!e.value.source_group?(x(),S("small",ge,"Обязательно")):M("",!0)]),a("div",he,[be,t(H,{id:"routing_policy",modelValue:e.value.routing_policy,"onUpdate:modelValue":o[3]||(o[3]=l=>e.value.routing_policy=l),required:"true",rows:"3",cols:"20",autofocus:"",class:T({"p-invalid":m.value&&!e.value.routing_policy})},null,8,["modelValue","class"]),m.value&&!e.value.routing_policy?(x(),S("small",ye,"Обязательно")):M("",!0)]),a("div",we,[Ve,t(d,{id:"created",modelValue:e.value.created,"onUpdate:modelValue":o[4]||(o[4]=l=>e.value.created=l),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),a("div",De,[ke,t(d,{id:"modified",modelValue:e.value.modified,"onUpdate:modelValue":o[5]||(o[5]=l=>e.value.modified=l),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),a("div",xe,[Se,t(d,{id:"author",modelValue:e.value.author,"onUpdate:modelValue":o[6]||(o[6]=l=>e.value.author=l),modelModifiers:{trim:!0},required:"true",disabled:""},null,8,["modelValue"])])]),_:1},8,["visible"]),t(U,{visible:y.value,"onUpdate:visible":o[8]||(o[8]=l=>y.value=l),title:"Внимание",msg:e.value?`Вы уверены, что хотите удалить ${e.value.source_group}?`:null,handler:O},null,8,["visible","msg"]),t(U,{visible:w.value,"onUpdate:visible":o[9]||(o[9]=l=>w.value=l),title:"Внимание",msg:"Вы уверены, что хотите удалить выделенные записи?",handler:E},null,8,["visible"])])])])}}};export{Te as default};
